<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>帮助文档 - 宿舍电费监控系统</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚡</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        html { scroll-behavior: smooth; }
        .prose { max-width: 65ch; }
        .prose h2 { margin-top: 2rem; margin-bottom: 1rem; }
        .prose h3 { margin-top: 1.5rem; margin-bottom: 0.75rem; }
        .prose p { margin-bottom: 1rem; }
        .prose ul { margin-bottom: 1rem; }
        .prose li { margin-bottom: 0.5rem; }
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin: 1rem 0;
        }
        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-100" x-data="{ sidebarOpen: false, showTopBtn: false, zoomedImage: null }" @scroll.window="showTopBtn = (window.pageYOffset > 300)" @keydown.escape.window="zoomedImage = null">

    <!-- Image Zoom Modal -->
    <div x-show="zoomedImage" 
         class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-90 transition-opacity duration-300"
         x-transition:enter="ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         @click="zoomedImage = null"
         style="display: none;">
        <div class="relative max-w-7xl max-h-screen p-4">
            <img :src="zoomedImage" class="max-w-full max-h-[90vh] rounded-lg shadow-2xl object-contain" @click.stop>
            <button @click="zoomedImage = null" class="absolute -top-12 right-0 text-white hover:text-gray-300 focus:outline-none">
                <i class="fas fa-times text-2xl"></i>
            </button>
        </div>
    </div>
    
    <!-- 顶部导航 -->
    <nav class="bg-white shadow-lg sticky top-0 z-30">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
            <!-- Left: Toggle Sidebar -->
            <div class="flex-1 flex justify-start">
                <button @click="sidebarOpen = true" class="lg:hidden text-gray-600 hover:text-blue-500 focus:outline-none flex items-center transition">
                    <i class="fas fa-bars text-xl"></i>
                    <span class="ml-2 font-medium hidden sm:inline">目录</span>
                </button>
            </div>
            
            <!-- Center: Title -->
            <h1 class="flex-shrink-0 text-xl font-bold text-gray-800">
                <i class="fas fa-book text-blue-500 mr-2"></i>帮助文档
            </h1>

            <!-- Right: Return Home -->
            <div class="flex-1 flex justify-end">
                <a href="/" class="text-blue-500 hover:text-blue-600 transition flex items-center">
                    <i class="fas fa-home mr-2"></i><span class="hidden sm:inline">返回首页</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Sidebar Drawer (Mobile) -->
    <!-- Backdrop -->
    <div x-show="sidebarOpen" @click="sidebarOpen = false" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0" class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden" style="display: none;"></div>

    <!-- Sidebar Panel -->
    <div class="fixed top-0 left-0 h-full w-64 bg-white shadow-2xl transform transition-transform duration-300 ease-in-out z-50 flex flex-col lg:hidden"
         :class="sidebarOpen ? 'translate-x-0' : '-translate-x-full'">
        <div class="p-6 border-b flex justify-between items-center bg-gray-50">
            <h2 class="text-xl font-bold text-gray-800 flex items-center"><i class="fas fa-list-ul mr-2 text-blue-500"></i> 目录</h2>
            <button @click="sidebarOpen = false" class="text-gray-500 hover:text-red-500 transition focus:outline-none">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div class="p-4 overflow-y-auto flex-1">
             <ul class="space-y-1">
                <li><a @click="sidebarOpen = false" href="#intro" class="block py-3 px-4 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-xl transition-colors font-medium">项目简介</a></li>
                <li><a @click="sidebarOpen = false" href="#features" class="block py-3 px-4 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-xl transition-colors font-medium">功能特性</a></li>
                <li><a @click="sidebarOpen = false" href="#quick-start" class="block py-3 px-4 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-xl transition-colors font-medium">快速开始</a></li>
                <li><a @click="sidebarOpen = false" href="#cookie-guide" class="block py-3 px-4 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-xl transition-colors font-medium">Cookie教程</a></li>
                <li><a @click="sidebarOpen = false" href="#config" class="block py-3 px-4 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-xl transition-colors font-medium">配置说明</a></li>
                <li><a @click="sidebarOpen = false" href="#faq" class="block py-3 px-4 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-xl transition-colors font-medium">常见问题/排障</a></li>
                <li><a @click="sidebarOpen = false" href="#api" class="block py-3 px-4 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-xl transition-colors font-medium">API接口</a></li>
                <li><a @click="sidebarOpen = false" href="#tech-stack" class="block py-3 px-4 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-xl transition-colors font-medium">技术栈</a></li>
            </ul>
        </div>
        <div class="p-4 border-t bg-gray-50 text-center text-xs text-gray-500">
            &copy; 2026 宿舍电费监控
        </div>
    </div>


    <div class="max-w-7xl mx-auto px-4 py-8 flex items-start gap-8">
        
        <!-- Sidebar (Desktop) -->
        <aside class="hidden lg:block w-64 flex-shrink-0 sticky top-24">
            <div class="bg-white rounded-xl shadow-md p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center"><i class="fas fa-list-ul mr-2 text-blue-500"></i> 目录</h2>
                <ul class="space-y-1">
                    <li><a href="#intro" class="block py-2 px-3 text-gray-600 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors">项目简介</a></li>
                    <li><a href="#features" class="block py-2 px-3 text-gray-600 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors">功能特性</a></li>
                    <li><a href="#quick-start" class="block py-2 px-3 text-gray-600 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors">快速开始</a></li>
                    <li><a href="#cookie-guide" class="block py-2 px-3 text-gray-600 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors">Cookie教程</a></li>
                    <li><a href="#config" class="block py-2 px-3 text-gray-600 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors">配置说明</a></li>
                    <li><a href="#faq" class="block py-2 px-3 text-gray-600 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors">常见问题/排障</a></li>
                    <li><a href="#api" class="block py-2 px-3 text-gray-600 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors">API接口</a></li>
                    <li><a href="#tech-stack" class="block py-2 px-3 text-gray-600 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors">技术栈</a></li>
                </ul>
            </div>
        </aside>

        <!-- 内容区 -->
        <main class="flex-1 min-w-0">
            <div class="bg-white rounded-xl shadow-md p-6 sm:p-8 prose prose-blue max-w-none">
            
            <!-- 项目简介 -->
            <section id="intro">
                <h2 class="text-3xl font-bold text-gray-800 border-b-2 border-blue-500 pb-2">
                    <i class="fas fa-info-circle text-blue-500"></i> 项目简介
                </h2>
                <p class="text-gray-700 leading-relaxed">
                    <strong>宿舍电费监控系统</strong>是一个自动化监控工具,定期检测校园宿舍剩余电量并在电量不足时发送邮件提醒。
                    系统提供 Web 管理界面（仪表盘/配置/扫码登录），支持多账号（多 source）轮询，并在 Cookie 失效或低电量时自动邮件告警。
                </p>
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-4">
                    <p class="text-blue-800">
                        <i class="fas fa-lightbulb mr-2"></i>
                        <strong>适用场景:</strong> 适合需要实时掌握宿舍电费状态的学生,避免突然断电影响学习生活。
                    </p>
                </div>
            </section>

            <!-- 功能特性 -->
            <section id="features">
                <h2 class="text-3xl font-bold text-gray-800 border-b-2 border-blue-500 pb-2 mt-8">
                    <i class="fas fa-star text-blue-500"></i> 功能特性
                </h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 my-6">
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-lg transform hover:-translate-y-1 hover:shadow-lg transition-all duration-300">
                        <h3 class="font-bold text-blue-800 mb-2">
                            <i class="fas fa-robot mr-2"></i>自动化监控
                        </h3>
                        <p class="text-sm text-gray-700">定时自动检测电量,无需手动操作</p>
                    </div>
                    <div class="bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-lg transform hover:-translate-y-1 hover:shadow-lg transition-all duration-300">
                        <h3 class="font-bold text-green-800 mb-2">
                            <i class="fas fa-envelope mr-2"></i>邮件提醒
                        </h3>
                        <p class="text-sm text-gray-700">低电量告警 + Cookie 失效修复提醒（含扫码链接）</p>
                    </div>
                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-lg transform hover:-translate-y-1 hover:shadow-lg transition-all duration-300">
                        <h3 class="font-bold text-purple-800 mb-2">
                            <i class="fas fa-mobile-alt mr-2"></i>响应式界面
                        </h3>
                        <p class="text-sm text-gray-700">支持手机/平板/电脑访问</p>
                    </div>
                    <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 p-4 rounded-lg transform hover:-translate-y-1 hover:shadow-lg transition-all duration-300">
                        <h3 class="font-bold text-yellow-800 mb-2">
                            <i class="fas fa-layer-group mr-2"></i>多账号/多宿舍（source）
                        </h3>
                        <p class="text-sm text-gray-700">按 source 独立保存 Cookie 与 UA，统一合并展示数据</p>
                    </div>
                    <div class="bg-gradient-to-br from-slate-50 to-slate-100 p-4 rounded-lg transform hover:-translate-y-1 hover:shadow-lg transition-all duration-300">
                        <h3 class="font-bold text-slate-800 mb-2">
                            <i class="fas fa-user-shield mr-2"></i>管理员权限
                        </h3>
                        <p class="text-sm text-gray-700">配置/暂停监控等操作走管理员 Token 鉴权</p>
                    </div>
                    <div class="bg-gradient-to-br from-rose-50 to-rose-100 p-4 rounded-lg transform hover:-translate-y-1 hover:shadow-lg transition-all duration-300">
                        <h3 class="font-bold text-rose-800 mb-2">
                            <i class="fas fa-shield-alt mr-2"></i>告警防轰炸
                        </h3>
                        <p class="text-sm text-gray-700">低电量告警带冷却时间，网络故障自动退避重试</p>
                    </div>
                </div>
            </section>

            <!-- 快速开始 -->
            <section id="quick-start">
                <h2 class="text-3xl font-bold text-gray-800 border-b-2 border-blue-500 pb-2 mt-8">
                    <i class="fas fa-rocket text-blue-500"></i> 快速开始
                </h2>

                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 my-4">
                    <p class="text-blue-800">
                        <i class="fas fa-info-circle mr-2"></i>
                        本项目默认以 <strong>Python 直接运行</strong> 的方式部署；如果你有容器化需求，可自行补充 Dockerfile/compose（代码层面没有强依赖）。
                    </p>
                </div>

                <h3 class="text-xl font-semibold text-gray-800 mt-6">
                    <span class="step-number">0</span>准备环境
                </h3>
                <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4">
                    <li>Python 3.9+（建议 3.9/3.10/3.11）</li>
                    <li>安装依赖：Flask / requests / bs4 / selenium / webdriver-manager</li>
                    <li>若使用扫码登录：本机需要可用的 Chrome/Chromium（Windows 一般已安装 Chrome）</li>
                </ul>
                <div class="code-block">
                    <code>pip install -r requirements.txt</code>
                </div>

                <h3 class="text-xl font-semibold text-gray-800 mt-6">
                    <span class="step-number">1</span>启动服务
                </h3>
                <div class="code-block">
                    <code>python main.py</code>
                </div>
                <p class="text-gray-700">
                    默认端口来自 <code class="bg-gray-200 px-2 py-1 rounded font-mono">config.ini</code> 的 <code class="bg-gray-200 px-2 py-1 rounded font-mono">[system].web_port</code>（默认 5000）。
                </p>

                <h3 class="text-xl font-semibold text-gray-800 mt-6">
                    <span class="step-number">2</span>打开仪表盘与扫码页
                </h3>
                <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4">
                    <li>仪表盘：<code class="bg-gray-200 px-2 py-1 rounded font-mono">http://0.0.0.0:5000/</code></li>
                    <li>帮助页：<code class="bg-gray-200 px-2 py-1 rounded font-mono">http://0.0.0.0:5000/help</code></li>
                    <li>扫码登录：<code class="bg-gray-200 px-2 py-1 rounded font-mono">http://0.0.0.0:5000/login</code></li>
                </ul>

                <h3 class="text-xl font-semibold text-gray-800 mt-6">
                    <span class="step-number">3</span>首次设置管理员 Token（推荐）
                </h3>
                <p class="text-gray-700">
                    配置接口（如读取/保存邮件参数、阈值、sources 等）需要管理员 Token。你可以在仪表盘右上角点击管理员按钮登录/设置。
                </p>

                <h3 class="text-xl font-semibold text-gray-800 mt-6">
                    <span class="step-number">4</span>配置邮件与阈值
                </h3>
                <p class="text-gray-700">进入“配置”页，建议至少完成：</p>
                <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4">
                    <li><strong>SMTP 邮箱</strong>：<code class="bg-gray-200 px-2 py-1 rounded font-mono">[notify].smtp_*</code>、<code class="bg-gray-200 px-2 py-1 rounded font-mono">[notify].from</code></li>
                    <li><strong>收件人</strong>：<code class="bg-gray-200 px-2 py-1 rounded font-mono">[notify].to</code>（或更精细的 rooms/sources 映射）</li>
                    <li><strong>低电量阈值</strong>：<code class="bg-gray-200 px-2 py-1 rounded font-mono">[system].low_power_threshold</code></li>
                </ul>
                
                <h3 class="text-xl font-semibold text-gray-800 mt-6">
                    <span class="step-number">5</span>登录系统（配置 Cookie）
                </h3>
                <p class="text-gray-700">有两种方式配置 Cookie：</p>
                <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4">
                    <li><strong>扫码登录(推荐)</strong>: 打开 <code class="bg-gray-200 px-2 py-1 rounded font-mono">/login</code>，使用微信扫码后系统自动保存 <code class="bg-gray-200 px-2 py-1 rounded font-mono">JSESSIONID</code></li>
                    <li><strong>手动输入</strong>: 通过仪表盘的“手动输入 Cookie”（后端走 <code class="bg-gray-200 px-2 py-1 rounded font-mono">/api/manual-cookie</code>）</li>
                </ul>

                <h3 class="text-xl font-semibold text-gray-800 mt-6">
                    <span class="step-number">6</span>发送测试邮件
                </h3>
                <p class="text-gray-700">
                    点击"发送测试邮件"按钮,确认邮件配置正常。如果收到测试邮件,说明系统配置成功。
                </p>
            </section>

            <!-- Cookie获取教程 -->
            <section id="cookie-guide">
                <h2 class="text-3xl font-bold text-gray-800 border-b-2 border-blue-500 pb-2 mt-8">
                    <i class="fas fa-cookie-bite text-blue-500"></i> Cookie获取教程
                </h2>

                <div class="bg-green-50 border-l-4 border-green-500 p-4 my-4">
                    <p class="text-green-800">
                        <i class="fas fa-check-circle mr-2"></i>
                        <strong>优先推荐：</strong>直接使用系统自带的扫码页 <code class="bg-white px-2 py-1 rounded font-mono border">/login</code> 获取 Cookie（无需手动抓包）。
                    </p>
                    <ul class="list-disc list-inside text-green-900/80 mt-2 space-y-1">
                        <li>默认扫码：<code class="bg-white px-2 py-1 rounded font-mono border">/login</code></li>
                        <li>指定某个账号(source)的扫码：<code class="bg-white px-2 py-1 rounded font-mono border">/login?source=xxx</code></li>
                        <li>二维码卡住/失效：<code class="bg-white px-2 py-1 rounded font-mono border">/login?force=1</code> 或 <code class="bg-white px-2 py-1 rounded font-mono border">/login-restart</code></li>
                    </ul>
                </div>

                <p class="text-gray-700 leading-relaxed">
                    系统抓取页面依赖业务站点的会话 Cookie（核心是 <code class="bg-gray-200 px-2 py-1 rounded font-mono">JSESSIONID</code>）。
                    Cookie 失效时，监控线程会在连续失败且判定为“需要重新登录”后，自动发送“修复邮件”，邮件里会带上可点击的扫码链接（链接由 <code class="bg-gray-200 px-2 py-1 rounded font-mono">[system].server_ip</code> + <code class="bg-gray-200 px-2 py-1 rounded font-mono">web_port</code> 生成）。
                </p>
                
                <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 my-4">
                    <p class="text-yellow-800">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        <strong>重要提示:</strong> 请勿将Cookie分享给他人，这是你的登录凭证!
                    </p>
                </div>

                <div class="space-y-8 mt-6">
                    <!-- 电脑端 -->
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800 flex items-center mb-4">
                            <i class="fas fa-desktop text-gray-500 mr-2"></i>电脑端
                        </h3>

                        <!-- 方法1 -->
                        <div class="bg-gray-50 rounded-xl p-6 mb-6 border border-gray-200">
                            <h4 class="text-lg font-bold text-blue-600 mb-3">方法1: 提取链接后缀 (推荐)</h4>
                            <ol class="list-decimal list-outside text-gray-700 space-y-6 ml-4">
                                <li>
                                    <p class="mb-2">使用浏览器访问 <a href="http://ids.lit.edu.cn/authserver/login?service=http%3A%2F%2Fzhyd.sec.lit.edu.cn%2Fzhyd%2Fsydl%2Findex" target="_blank" class="text-blue-500 hover:underline font-medium">统一身份认证</a> 进行登录。</p>
                                    <img src="/static/help_img/login_page.png" alt="登录界面" class="rounded-lg shadow-md border max-w-full md:max-w-lg hover:shadow-xl transition-shadow duration-300 cursor-zoom-in" @click="zoomedImage = $el.src">
                                </li>
                                <li>
                                    <p class="mb-2">成功登录后的界面如下：</p>
                                    <img src="/static/help_img/login_success.png" alt="成功登录界面" class="rounded-lg shadow-md border max-w-full md:max-w-lg hover:shadow-xl transition-shadow duration-300 cursor-zoom-in" @click="zoomedImage = $el.src">
                                </li>
                                <li>
                                    <p class="mb-2">复制地址栏中的 <code class="bg-gray-200 px-2 py-1 rounded text-red-500 font-mono">JSESSIONID=xxxxxxxxx</code> 部分。</p>
                                    <img src="/static/help_img/url_jsessionid.png" alt="复制 JSESSIONID" class="rounded-lg shadow-md border max-w-full md:max-w-lg hover:shadow-xl transition-shadow duration-300 cursor-zoom-in" @click="zoomedImage = $el.src">
                                </li>
                            </ol>
                        </div>

                        <!-- 方法2 -->
                        <div class="bg-gray-50 rounded-xl p-6 border border-gray-200">
                            <h4 class="text-lg font-bold text-blue-600 mb-3">方法2: 使用开发者工具</h4>
                            <ol class="list-decimal list-outside text-gray-700 space-y-6 ml-4">
                                <li>参考方法一进行登录。</li>
                                <li>
                                    <p class="mb-2">按 <kbd class="bg-white border border-gray-300 px-2 py-1 rounded text-sm text-gray-500 font-mono shadow-sm">F12</kbd> 打开开发者工具。</p>
                                    <img src="/static/help_img/dev_tools_f12.png" alt="F12 开发者工具" class="rounded-lg shadow-md border max-w-full md:max-w-lg hover:shadow-xl transition-shadow duration-300 cursor-zoom-in" @click="zoomedImage = $el.src">
                                </li>
                                <li>
                                    <p class="mb-2">切换到 <strong>Network (网络)</strong> 选项卡。</p>
                                    <img src="/static/help_img/network_tab.png" alt="Network 选项卡" class="rounded-lg shadow-md border max-w-full md:max-w-lg hover:shadow-xl transition-shadow duration-300 cursor-zoom-in" @click="zoomedImage = $el.src">
                                </li>
                                <li>刷新页面 (<kbd class="bg-white border border-gray-300 px-2 py-1 rounded text-sm text-gray-500 font-mono shadow-sm">F5</kbd>)。</li>
                                <li>
                                    <p class="mb-2">点击任意请求，在右侧找到 <strong>Request Headers (请求头)</strong>，找到 <code class="bg-gray-200 px-2 py-1 rounded font-mono">Cookie:</code> 字段，复制其中的 <code class="bg-gray-200 px-2 py-1 rounded text-red-500 font-mono">JSESSIONID=xxxxxxxxx</code> 部分。</p>
                                    <img src="/static/help_img/header_cookie.png" alt="复制 Cookie 中的 JSESSIONID" class="rounded-lg shadow-md border max-w-full md:max-w-lg hover:shadow-xl transition-shadow duration-300 cursor-zoom-in" @click="zoomedImage = $el.src">
                                </li>
                            </ol>
                        </div>
                    </div>

                    <!-- 手机端 -->
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800 flex items-center mb-4">
                            <i class="fas fa-mobile-alt text-gray-500 mr-2"></i>手机端
                        </h3>
                        <p class="text-gray-700 leading-relaxed bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500">
                            <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                            建议使用 <strong>电脑端的方法一</strong> 获取，因为手机端浏览器通常无法方便地使用开发者工具查看 Cookie。
                        </p>
                    </div>
                </div>

                <div class="bg-gray-100 p-4 rounded-lg mt-8 text-sm text-gray-600">
                    <p>
                        <i class="fas fa-info-circle mr-2"></i>
                        <strong>格式说明:</strong> Cookie 格式为 <code class="bg-white px-2 py-1 rounded font-mono border">JSESSIONID=一串字母数字</code>，
                        如果只复制了后面的值，系统会自动补全前缀。
                    </p>
                </div>
            </section>

            <!-- 配置说明 -->
            <section id="config">
                <h2 class="text-3xl font-bold text-gray-800 border-b-2 border-blue-500 pb-2 mt-8">
                    <i class="fas fa-cog text-blue-500"></i> 配置说明
                </h2>

                <p class="text-gray-700 leading-relaxed">
                    所有配置存放在项目根目录的 <code class="bg-gray-200 px-2 py-1 rounded font-mono">config.ini</code>。
                    系统支持<strong>多 source</strong>：每个 source 对应独立的 <code class="bg-gray-200 px-2 py-1 rounded font-mono">[auth.&lt;source&gt;]</code> 段（独立 Cookie/UA），监控线程会按 <code class="bg-gray-200 px-2 py-1 rounded font-mono">[system].auth_sources</code> 轮询并合并结果。
                </p>

                <h3 class="text-2xl font-bold text-gray-800 mt-6">1) system（运行参数）</h3>
                <div class="overflow-x-auto my-4">
                    <table class="min-w-full border border-gray-300 text-sm">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="border border-gray-300 px-4 py-2 text-left">键</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">作用</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">示例/推荐</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="border border-gray-300 px-4 py-2 font-mono">interval</td>
                                <td class="border border-gray-300 px-4 py-2">监控抓取间隔（秒）。网络/服务器故障时会自动退避（更快重试）。</td>
                                <td class="border border-gray-300 px-4 py-2">900（15 分钟）</td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="border border-gray-300 px-4 py-2 font-mono">web_port</td>
                                <td class="border border-gray-300 px-4 py-2">Web 服务监听端口。</td>
                                <td class="border border-gray-300 px-4 py-2">5000</td>
                            </tr>
                            <tr>
                                <td class="border border-gray-300 px-4 py-2 font-mono">server_ip</td>
                                <td class="border border-gray-300 px-4 py-2">用于生成“修复邮件”里的扫码链接（必须是收件人能访问到的地址）。</td>
                                <td class="border border-gray-300 px-4 py-2">同局域网：192.168.x.x；本机：127.0.0.1</td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="border border-gray-300 px-4 py-2 font-mono">low_power_threshold</td>
                                <td class="border border-gray-300 px-4 py-2">低电量阈值（度），低于该值发送告警邮件。</td>
                                <td class="border border-gray-300 px-4 py-2">15</td>
                            </tr>
                            <tr>
                                <td class="border border-gray-300 px-4 py-2 font-mono">low_power_alert_cooldown_seconds</td>
                                <td class="border border-gray-300 px-4 py-2">同一房间低电量告警冷却时间（秒），防止轰炸。</td>
                                <td class="border border-gray-300 px-4 py-2">21600（6 小时）</td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="border border-gray-300 px-4 py-2 font-mono">auth_sources</td>
                                <td class="border border-gray-300 px-4 py-2">要轮询的 source 列表（逗号/分号/换行分隔）。</td>
                                <td class="border border-gray-300 px-4 py-2">x3-721a,x3-721b,x3-721k</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3 class="text-2xl font-bold text-gray-800 mt-6">2) auth（Cookie/UA）与多 source</h3>
                <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4">
                    <li><code class="bg-gray-200 px-2 py-1 rounded font-mono">[auth]</code>：旧版单账号段（兼容）。</li>
                    <li><code class="bg-gray-200 px-2 py-1 rounded font-mono">[auth.&lt;source&gt;]</code>：推荐使用的多账号段，每个 source 单独保存 <code class="bg-gray-200 px-2 py-1 rounded font-mono">cookie</code> 与 <code class="bg-gray-200 px-2 py-1 rounded font-mono">user_agent</code>。</li>
                    <li>如果未设置 <code class="bg-gray-200 px-2 py-1 rounded font-mono">auth_sources</code> 且只配置了 <code class="bg-gray-200 px-2 py-1 rounded font-mono">[auth].cookie</code>，系统会进入 legacy 单源模式，避免重复轮询同一 Cookie。</li>
                </ul>
                <div class="code-block">
                    <code>[auth.x3-721b]\ncookie = JSESSIONID=...\nuser_agent = Mozilla/5.0 ...</code>
                </div>

                <h3 class="text-2xl font-bold text-gray-800 mt-6">3) notify（邮件）与收件人策略</h3>
                <p class="text-gray-700">
                    系统支持三层收件人优先级（从高到低）：
                </p>
                <ol class="list-decimal list-inside text-gray-700 space-y-2 ml-4">
                    <li><strong>按房间</strong>：<code class="bg-gray-200 px-2 py-1 rounded font-mono">[notify.rooms]</code></li>
                    <li><strong>按 source 默认</strong>：<code class="bg-gray-200 px-2 py-1 rounded font-mono">[notify.sources]</code></li>
                    <li><strong>回退到默认</strong>：<code class="bg-gray-200 px-2 py-1 rounded font-mono">[notify].to</code>（以及兼容旧模式的 group_a/group_b/group_k）</li>
                </ol>
                <div class="code-block">
                    <code>[notify]\nsmtp_server = smtp.qq.com\nsmtp_port = 465\nsmtp_tls = ssl\nsmtp_username = your_email@qq.com\nsmtp_password = your_smtp_password\nfrom = your_email@qq.com\nto = a@example.com,b@example.com\n\n[notify.sources]\nx3-721b = a@example.com,b@example.com\n\n[notify.rooms]\n3-721B空调 = a@example.com</code>
                </div>

                <h3 class="text-2xl font-bold text-gray-800 mt-6">4) admin（管理员 Token）</h3>
                <p class="text-gray-700">
                    管理员 Token 用于保护配置/测试邮件/暂停监控等接口，后端通过请求头 <code class="bg-gray-200 px-2 py-1 rounded font-mono">X-Admin-Token</code> 校验。
                </p>
                <div class="code-block">
                    <code>[admin]\nadmin_token = your_token_here</code>
                </div>

                <h3 class="text-2xl font-bold text-gray-800 mt-6">5) auth.labels（source 显示名称）</h3>
                <p class="text-gray-700">用于把 source 显示成更易懂的中文名（仪表盘展示时更友好）：</p>
                <div class="code-block">
                    <code>[auth.labels]\nx3-721a = 琇3-721A\nx3-721b = 琇3-721B</code>
                </div>
            </section>

            <!-- 常见问题 -->
            <section id="faq">
                <h2 class="text-3xl font-bold text-gray-800 border-b-2 border-blue-500 pb-2 mt-8">
                    <i class="fas fa-question-circle text-blue-500"></i> 常见问题/排障
                </h2>

                <div class="space-y-6 mt-6">
                    <div class="border-l-4 border-blue-500 pl-4">
                        <h3 class="font-bold text-gray-800">Q: Cookie多久会失效?</h3>
                        <p class="text-gray-700">A: 通常几天到一周,失效后系统会发邮件提醒,重新扫码即可。</p>
                    </div>

                    <div class="border-l-4 border-blue-500 pl-4">
                        <h3 class="font-bold text-gray-800">Q: 运行 <span class="font-mono">python main.py</span> 直接退出(Exit Code 1)怎么办?</h3>
                        <p class="text-gray-700">A: 常见原因与处理：</p>
                        <ul class="list-disc list-inside ml-4 text-gray-700">
                            <li>依赖缺失：先执行 <span class="font-mono">pip install -r requirements.txt</span></li>
                            <li>Python 环境不一致：确认运行的是同一个 Python（建议在虚拟环境中安装依赖）</li>
                            <li>端口被占用：修改 <span class="font-mono">config.ini</span> 中 <span class="font-mono">[system].web_port</span></li>
                        </ul>
                    </div>

                    <div class="border-l-4 border-green-500 pl-4">
                        <h3 class="font-bold text-gray-800">Q: 为什么没收到邮件通知?</h3>
                        <p class="text-gray-700">A: 请检查:</p>
                        <ul class="list-disc list-inside ml-4 text-gray-700">
                            <li>收件人邮箱是否正确</li>
                            <li>检查垃圾邮件箱</li>
                            <li>点击"发送测试邮件"验证配置</li>
                            <li>QQ邮箱等需要使用“SMTP授权码”，不是邮箱登录密码</li>
                            <li>如果配置了 <span class="font-mono">[notify.rooms]</span>/<span class="font-mono">[notify.sources]</span>，收件人可能被更高优先级覆盖</li>
                        </ul>
                    </div>

                    <div class="border-l-4 border-yellow-500 pl-4">
                        <h3 class="font-bold text-gray-800">Q: 可以监控多个房间吗?</h3>
                        <p class="text-gray-700">A: 可以!如果你的账号绑定了多个房间,系统会自动显示所有房间的电量。</p>
                    </div>

                    <div class="border-l-4 border-yellow-500 pl-4">
                        <h3 class="font-bold text-gray-800">Q: 什么是 source? 为什么要配置多个?</h3>
                        <p class="text-gray-700">A: source 是“账号/宿舍”的逻辑标识。每个 source 对应一份 Cookie/UA（例如 <span class="font-mono">[auth.x3-721b]</span>）。系统会按 <span class="font-mono">[system].auth_sources</span> 轮询抓取并合并展示。</p>
                    </div>

                    <div class="border-l-4 border-purple-500 pl-4">
                        <h3 class="font-bold text-gray-800">Q: 手动输入Cookie后没反应?</h3>
                        <p class="text-gray-700">A: Cookie 保存后会“请求立即刷新”，一般很快生效；如果仍无数据：</p>
                        <ul class="list-disc list-inside ml-4 text-gray-700">
                            <li>确认 Cookie 只需要 <span class="font-mono">JSESSIONID=...</span></li>
                            <li>确认对应 source 正确（多 source 场景尤其常见）</li>
                            <li>学校系统可能短暂 502/超时，稍后重试即可</li>
                        </ul>
                    </div>

                    <div class="border-l-4 border-red-500 pl-4">
                        <h3 class="font-bold text-gray-800">Q: 显示"Cookie已失效"怎么办?</h3>
                        <p class="text-gray-700">A: 点击"扫码登录"或"手动输入"重新设置Cookie即可。</p>
                    </div>

                    <div class="border-l-4 border-red-500 pl-4">
                        <h3 class="font-bold text-gray-800">Q: 扫码页不出二维码 / 一直失败?</h3>
                        <p class="text-gray-700">A: 这是 Selenium/Chrome 环境问题居多：</p>
                        <ul class="list-disc list-inside ml-4 text-gray-700">
                            <li>确认本机已安装 Chrome；或换用非精简系统环境</li>
                            <li>公司/校园网可能拦截 webdriver 下载；可手动放置 <span class="font-mono">chromedriver.exe</span> 到项目目录</li>
                            <li>二维码可能已过期：用 <span class="font-mono">/login?force=1</span> 重新生成</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- API接口 -->
            <section id="api">
                <h2 class="text-3xl font-bold text-gray-800 border-b-2 border-blue-500 pb-2 mt-8">
                    <i class="fas fa-network-wired text-blue-500"></i> API接口
                </h2>

                <p class="text-gray-700 leading-relaxed">
                    系统提供以 <code class="bg-gray-200 px-2 py-1 rounded font-mono">/api</code> 为前缀的 JSON 接口。部分接口需要管理员 Token：在请求头里带 <code class="bg-gray-200 px-2 py-1 rounded font-mono">X-Admin-Token: &lt;token&gt;</code>。
                </p>

                <h3 class="text-2xl font-bold text-gray-800 mt-6">公开接口</h3>
                <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4">
                    <li><code class="bg-gray-200 px-2 py-1 rounded font-mono">GET /api/status</code>：系统状态（监控是否运行、上次数据、sources 状态等）</li>
                    <li><code class="bg-gray-200 px-2 py-1 rounded font-mono">GET /api/login-state</code>：扫码登录状态（不含二维码图片）</li>
                </ul>

                <h3 class="text-2xl font-bold text-gray-800 mt-6">管理员接口（需要 X-Admin-Token）</h3>
                <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4">
                    <li><code class="bg-gray-200 px-2 py-1 rounded font-mono">GET /api/config</code>：读取配置（含敏感项，必须鉴权）</li>
                    <li><code class="bg-gray-200 px-2 py-1 rounded font-mono">POST /api/config</code>：保存配置（interval/threshold/cooldown/收件人映射/auth_sources/auth_labels 等）</li>
                    <li><code class="bg-gray-200 px-2 py-1 rounded font-mono">POST /api/test-email</code>：发送测试邮件（可选指定 to）</li>
                    <li><code class="bg-gray-200 px-2 py-1 rounded font-mono">POST /api/toggle-monitoring</code>：暂停/恢复监控（body: {enabled: true/false}）</li>
                    <li><code class="bg-gray-200 px-2 py-1 rounded font-mono">GET /api/admin/check</code>：是否已设置管理员 Token</li>
                    <li><code class="bg-gray-200 px-2 py-1 rounded font-mono">POST /api/admin/setup</code>：首次设置管理员 Token</li>
                    <li><code class="bg-gray-200 px-2 py-1 rounded font-mono">POST /api/admin/login</code>：管理员登录</li>
                </ul>

                <h3 class="text-2xl font-bold text-gray-800 mt-6">Cookie 相关接口</h3>
                <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4">
                    <li><code class="bg-gray-200 px-2 py-1 rounded font-mono">POST /api/manual-cookie</code>：手动设置某个 source 的 Cookie（body: {source, cookie, user_agent}）</li>
                </ul>

                <div class="code-block">
                    <code>curl -H "X-Admin-Token: your_token" http://127.0.0.1:5000/api/config</code>
                </div>
            </section>

            <!-- 技术栈 -->
            <section id="tech-stack">
                <h2 class="text-3xl font-bold text-gray-800 border-b-2 border-blue-500 pb-2 mt-8">
                    <i class="fas fa-code text-blue-500"></i> 技术栈
                </h2>
                <div class="grid grid-cols-2 sm:grid-cols-3 gap-4 my-6">
                    <div class="bg-gray-100 p-4 rounded-lg text-center">
                        <i class="fab fa-python text-4xl text-blue-600 mb-2"></i>
                        <p class="font-medium">Python 3.8+</p>
                    </div>
                    <div class="bg-gray-100 p-4 rounded-lg text-center">
                        <i class="fas fa-server text-4xl text-green-600 mb-2"></i>
                        <p class="font-medium">Flask</p>
                    </div>
                    <div class="bg-gray-100 p-4 rounded-lg text-center">
                        <i class="fas fa-globe text-4xl text-sky-600 mb-2"></i>
                        <p class="font-medium">Requests</p>
                    </div>
                    <div class="bg-gray-100 p-4 rounded-lg text-center">
                        <i class="fas fa-robot text-4xl text-purple-600 mb-2"></i>
                        <p class="font-medium">Selenium</p>
                    </div>
                    <div class="bg-gray-100 p-4 rounded-lg text-center">
                        <i class="fas fa-leaf text-4xl text-emerald-600 mb-2"></i>
                        <p class="font-medium">BeautifulSoup4</p>
                    </div>
                    <div class="bg-gray-100 p-4 rounded-lg text-center">
                        <i class="fab fa-js text-4xl text-yellow-500 mb-2"></i>
                        <p class="font-medium">Alpine.js</p>
                    </div>
                    <div class="bg-gray-100 p-4 rounded-lg text-center">
                        <i class="fas fa-wind text-4xl text-cyan-500 mb-2"></i>
                        <p class="font-medium">Tailwind CSS</p>
                    </div>
                </div>
            </section>

            <!-- 联系支持 -->
            <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl p-6 text-white text-center mt-8">
                <h3 class="text-2xl font-bold mb-2">
                    <i class="fas fa-hands-helping mr-2"></i>需要帮助?
                </h3>
                <p class="mb-4">如果遇到问题,建议先查看运行日志（终端输出）并确认配置是否生效</p>
                <div class="code-block text-left">
                    <code># 安装依赖（首次）<br>pip install -r requirements.txt<br><br># 启动服务<br>python main.py</code>
                </div>
            </div>

        </div>

        </main>
    </div>

        <!-- 悬浮返回顶部 -->
        <a href="#" 
           x-show="showTopBtn" 
           x-transition:enter="transition ease-out duration-300"
           x-transition:enter-start="opacity-0 translate-y-4"
           x-transition:enter-end="opacity-100 translate-y-0"
           x-transition:leave="transition ease-in duration-200"
           x-transition:leave-start="opacity-100 translate-y-0"
           x-transition:leave-end="opacity-0 translate-y-4"
           class="fixed bottom-8 right-8 bg-blue-500/50 hover:bg-blue-600/80 text-white w-10 h-10 rounded-full flex items-center justify-center shadow-lg backdrop-blur-sm transition-all z-40"
           title="返回顶部"
           style="display: none;">
            <i class="fas fa-arrow-up text-sm"></i>
        </a>

    </div>

</body>
</html>